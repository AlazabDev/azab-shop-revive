# 🧪 دليل الاختبار المحلي الشامل

**الإصدار:** 1.0  
**تاريخ التحديث:** 17 أكتوبر 2025

---

## 📋 المتطلبات الأساسية

### 1. البرامج المطلوبة
```bash
# Node.js (الإصدار 18 أو أحدث)
node --version  # يجب أن يكون >= 18.x

# npm (يأتي مع Node.js)
npm --version   # يجب أن يكون >= 9.x

# Git
git --version   # أي إصدار حديث
```

### 2. حساب Supabase
- ✅ متوفر: `https://zrrffsjbfkphridqyais.supabase.co`
- ✅ المفاتيح موجودة في `.env`

---

## 🚀 خطوات التشغيل المحلي

### الخطوة 1: استنساخ المشروع (إذا لم يكن موجوداً)

```bash
# استنساخ المشروع من GitHub (إذا كان موجوداً)
git clone <repository-url>
cd <project-name>

# أو إذا كان المشروع موجوداً محلياً
cd /path/to/project
```

### الخطوة 2: تثبيت الحزم

```bash
# تثبيت جميع التبعيات
npm install

# التحقق من عدم وجود أخطاء
npm list
```

**الوقت المتوقع:** 2-5 دقائق (حسب سرعة الإنترنت)

### الخطوة 3: إعداد المتغيرات البيئية

```bash
# التحقق من ملف .env
cat .env
```

**يجب أن يحتوي على:**
```env
VITE_SUPABASE_PROJECT_ID="zrrffsjbfkphridqyais"
VITE_SUPABASE_PUBLISHABLE_KEY="eyJhbGc..."
VITE_SUPABASE_URL="https://zrrffsjbfkphridqyais.supabase.co"
```

> ⚠️ **ملاحظة:** إذا كان الملف غير موجود، انسخ من `.env.example`

### الخطوة 4: تشغيل السيرفر المحلي

```bash
# تشغيل السيرفر على المنفذ 8080
npm run dev
```

**النتيجة المتوقعة:**
```
  VITE v5.x.x  ready in XXX ms

  ➜  Local:   http://localhost:8080/
  ➜  Network: http://[::]:8080/
```

### الخطوة 5: فتح التطبيق

افتح المتصفح على: **http://localhost:8080**

---

## ✅ قائمة الاختبار الشاملة

### 1️⃣ اختبار الصفحة الرئيسية (Landing Page)

#### الوصول
- [ ] الصفحة تفتح بدون أخطاء
- [ ] جميع الصور تحمل بشكل صحيح
- [ ] الـ animations تعمل بسلاسة
- [ ] النصوص العربية تظهر بشكل صحيح

#### العناصر التفاعلية
- [ ] زر "ابدأ الآن" يعمل
- [ ] القائمة (Navigation) تعمل
- [ ] الروابط في الـ Footer تعمل
- [ ] الأقسام (Features, Services, Stats) تظهر

**الوقت المتوقع:** 5 دقائق

---

### 2️⃣ اختبار التسجيل والدخول

#### تسجيل حساب جديد

```
الخطوات:
1. انتقل إلى /register
2. أدخل البيانات:
   - الاسم الأول: اختبار
   - الاسم الأخير: محلي
   - البريد: test+local@example.com
   - الهاتف: +201234567890
   - كلمة المرور: Test@123456
3. اضغط "تسجيل"
```

**النتيجة المتوقعة:**
- [ ] رسالة "تم التسجيل بنجاح"
- [ ] إرسال بريد تأكيد (تحقق من Supabase Dashboard)
- [ ] إعادة توجيه إلى صفحة اختيار الدور

#### اختيار الدور

```
الخطوات:
1. في صفحة /role-selection
2. اختر "عميل" (Customer)
3. اضغط "متابعة"
```

**النتيجة المتوقعة:**
- [ ] إعادة توجيه إلى Dashboard
- [ ] الدور محفوظ في `profiles` table

#### تسجيل الدخول

```
الخطوات:
1. سجل الخروج (Log out)
2. انتقل إلى /login
3. أدخل البريد وكلمة المرور
4. اضغط "تسجيل الدخول"
```

**النتيجة المتوقعة:**
- [ ] تسجيل دخول ناجح
- [ ] إعادة توجيه إلى Dashboard
- [ ] Session محفوظة (تحديث الصفحة لا يسجل الخروج)

**الوقت المتوقع:** 10 دقائق

---

### 3️⃣ اختبار لوحة التحكم (Dashboard)

#### الوصول
- [ ] الصفحة تفتح على `/dashboard`
- [ ] الإحصائيات تظهر (حتى لو كانت صفر)
- [ ] الرسوم البيانية تعمل
- [ ] الطلبات الأخيرة تظهر

#### Quick Actions
- [ ] "طلب جديد" يفتح نموذج
- [ ] "عرض كل الطلبات" ينتقل لصفحة الطلبات
- [ ] جميع الأزرار تعمل

**الوقت المتوقع:** 5 دقائق

---

### 4️⃣ اختبار طلبات الصيانة

#### إنشاء طلب جديد

```
الخطوات:
1. من Dashboard، اضغط "طلب صيانة جديد"
2. أدخل البيانات:
   - العنوان: اختبار صيانة كهرباء
   - الوصف: فحص كامل للكهرباء
   - الأولوية: عالية (High)
   - نوع الخدمة: صيانة
   - العقار: (اختر أو أنشئ جديد)
3. ارفع صورة (اختياري)
4. اضغط "إرسال الطلب"
```

**النتيجة المتوقعة:**
- [ ] رسالة "تم إرسال الطلب بنجاح"
- [ ] الطلب يظهر في قائمة الطلبات
- [ ] الحالة الأولية: "pending"
- [ ] تسجيل في `maintenance_requests` table

#### عرض تفاصيل الطلب

```
الخطوات:
1. انتقل إلى /requests
2. اضغط على الطلب الجديد
```

**النتيجة المتوقعة:**
- [ ] تفاصيل الطلب كاملة
- [ ] الحالة (Status Badge)
- [ ] الأولوية (Priority Badge)
- [ ] زر "تعديل" (إذا كانت الصلاحية تسمح)

#### تصفية الطلبات

```
الخطوات:
1. في /requests
2. اختبر الفلاتر:
   - حسب الحالة (Pending, In Progress, Completed)
   - حسب الأولوية (High, Medium, Low)
   - حسب التاريخ
```

**النتيجة المتوقعة:**
- [ ] الفلاتر تعمل بشكل صحيح
- [ ] النتائج تتحدث فورياً
- [ ] عدد النتائج يظهر

**الوقت المتوقع:** 15 دقائق

---

### 5️⃣ اختبار العقارات

#### إضافة عقار جديد

```
الخطوات:
1. انتقل إلى /properties
2. اضغط "إضافة عقار جديد"
3. أدخل البيانات:
   - الاسم: شقة اختبار محلي
   - العنوان: شارع الاختبار، القاهرة
   - النوع: شقة
   - المساحة: 120
   - الوحدة: متر مربع
4. حدد الموقع على الخريطة
5. اضغط "حفظ"
```

**النتيجة المتوقعة:**
- [ ] العقار يضاف بنجاح
- [ ] يظهر في قائمة العقارات
- [ ] الخريطة تعمل بشكل صحيح
- [ ] QR Code يتم توليده

#### اختبار Google Maps

```
الخطوات:
1. في نموذج العقار
2. اضغط "تحديد على الخريطة"
3. اختر موقع
```

**النتيجة المتوقعة:**
- [ ] الخريطة تحمل بدون أخطاء
- [ ] يمكن اختيار الموقع
- [ ] الإحداثيات تُحفظ
- [ ] Marker يظهر على الموقع

> ⚠️ **ملاحظة:** إذا لم تعمل الخريطة، تحقق من Google Maps API Key في Supabase

**الوقت المتوقع:** 10 دقائق

---

### 6️⃣ اختبار الصلاحيات (Roles)

#### إنشاء مستخدمين بأدوار مختلفة

```bash
# ستحتاج لإنشاء 6 حسابات:
1. admin@test.com       → Admin
2. manager@test.com     → Manager
3. staff@test.com       → Staff
4. tech@test.com        → Technician
5. vendor@test.com      → Vendor
6. customer@test.com    → Customer
```

#### اختبار صلاحيات Admin

```
تسجيل دخول: admin@test.com
الاختبارات:
- [ ] يمكن رؤية جميع الطلبات
- [ ] يمكن تعديل أي طلب
- [ ] يمكن حذف أي طلب
- [ ] يمكن الوصول لصفحة Settings
- [ ] يمكن رؤية جميع العقارات
```

#### اختبار صلاحيات Customer

```
تسجيل دخول: customer@test.com
الاختبارات:
- [ ] يرى طلباته فقط
- [ ] لا يمكنه رؤية طلبات الآخرين
- [ ] يمكنه إنشاء طلب جديد
- [ ] لا يمكنه الوصول لصفحات الإدارة
```

#### اختبار صلاحيات Technician

```
تسجيل دخول: tech@test.com
الاختبارات:
- [ ] يرى الطلبات المخصصة له
- [ ] يمكنه تحديث حالة الطلب
- [ ] يمكنه إضافة ملاحظات
- [ ] لا يمكنه حذف الطلبات
```

**الوقت المتوقع:** 30 دقائق

---

### 7️⃣ اختبار الإشعارات

#### إنشاء إشعار

```
الخطوات:
1. كـ Admin، أنشئ طلب صيانة جديد
2. خصص الطلب لـ Technician
```

**النتيجة المتوقعة:**
- [ ] Technician يستلم إشعار
- [ ] الإشعار يظهر في قائمة الإشعارات
- [ ] النقر على الإشعار ينتقل للطلب
- [ ] عدد الإشعارات الجديدة يظهر (Badge)

**الوقت المتوقع:** 5 دقائق

---

### 8️⃣ اختبار معرض الصور

#### رفع صورة جديدة

```
الخطوات:
1. انتقل إلى /gallery
2. اضغط "رفع صورة جديدة"
3. اختر صورة من جهازك
4. أدخل العنوان والوصف
5. اضغط "رفع"
```

**النتيجة المتوقعة:**
- [ ] الصورة ترفع بنجاح
- [ ] تظهر في المعرض
- [ ] يمكن عرضها بحجم كامل
- [ ] يمكن حذفها (Admin فقط)

**الوقت المتوقع:** 5 دقائق

---

### 9️⃣ اختبار Chatbot

#### فتح Chatbot

```
الخطوات:
1. اضغط على أيقونة Chat في أسفل يمين الصفحة
2. أرسل رسالة: "ما هي خدماتكم؟"
```

**النتيجة المتوقعة:**
- [ ] Chatbot يفتح بشكل صحيح
- [ ] يرد على الرسالة خلال 3-5 ثواني
- [ ] الرد باللغة العربية
- [ ] معلومات دقيقة من knowledge base

> ⚠️ **ملاحظة:** يحتاج `DEEPSEEK_API_KEY` في Supabase Secrets

**الوقت المتوقع:** 5 دقائق

---

### 🔟 اختبار التقارير

#### تصدير تقرير طلبات الصيانة

```
الخطوات:
1. انتقل إلى /reports
2. اختر نطاق التاريخ
3. اضغط "تصدير Excel"
```

**النتيجة المتوقعة:**
- [ ] ملف Excel يتم تحميله
- [ ] البيانات صحيحة
- [ ] التنسيق احترافي

**الوقت المتوقع:** 5 دقائق

---

## 🧪 اختبار صفحة Testing الشاملة

### الوصول للصفحة

```
URL: http://localhost:8080/testing
```

### تشغيل جميع الاختبارات

```
الخطوات:
1. افتح /testing
2. اضغط "تشغيل جميع الاختبارات"
3. انتظر حتى انتهاء جميع الاختبارات
```

**النتيجة المتوقعة:**
- [ ] 50+ اختبار يعمل
- [ ] معدل النجاح > 90%
- [ ] أي فشل يكون له سبب واضح
- [ ] الوقت الإجمالي < 30 ثانية

### اختبارات محددة

```
الفئات المتاحة:
✅ Database Connection
✅ Authentication
✅ Maintenance Requests
✅ Properties
✅ Storage (Gallery)
✅ Edge Functions
✅ RLS Policies
✅ Network
```

**الوقت المتوقع:** 10 دقائق

---

## 🐛 اختبار الأخطاء (Error Handling)

### 1. اختبار Error Tracking

```
الخطوات:
1. افتح Console في المتصفح (F12)
2. ارمِ خطأ متعمد:
   - اضغط على زر غير موجود
   - أدخل بيانات خاطئة في نموذج
3. تحقق من:
   - [ ] رسالة خطأ واضحة للمستخدم
   - [ ] Toast notification يظهر
   - [ ] الخطأ لا يعطل التطبيق كاملاً
```

### 2. فحص Error Logs في Supabase

```
الخطوات:
1. انتقل إلى Supabase Dashboard
2. Table Editor → error_logs
3. تحقق من وجود السجلات الجديدة
```

**النتيجة المتوقعة:**
- [ ] الأخطاء تُسجل في الجدول
- [ ] معلومات كاملة (message, stack, url, user_id)
- [ ] Timestamp صحيح

**الوقت المتوقع:** 5 دقائق

---

## 📱 اختبار الأجهزة المحمولة

### Responsive Design

```
الخطوات:
1. افتح Chrome DevTools (F12)
2. اضغط Toggle Device Toolbar (Ctrl+Shift+M)
3. جرب الأجهزة:
   - [ ] iPhone 12 Pro
   - [ ] iPad
   - [ ] Samsung Galaxy S20
```

**النتيجة المتوقعة:**
- [ ] التصميم يتكيف بشكل صحيح
- [ ] القوائم تعمل (Hamburger Menu)
- [ ] النماذج قابلة للاستخدام
- [ ] الأزرار بحجم مناسب للمس

### اختبار على جهاز حقيقي

```
الخطوات:
1. تأكد أن جهازك على نفس الشبكة
2. اعرف عنوان IP جهازك:
   Windows: ipconfig
   Mac/Linux: ifconfig
3. افتح على الموبايل:
   http://<your-ip>:8080
```

**مثال:**
```
http://192.168.1.100:8080
```

**الوقت المتوقع:** 10 دقائق

---

## 🔍 فحص الأداء (Performance Testing)

### 1. Lighthouse Audit

```
الخطوات:
1. في Chrome DevTools
2. تبويب "Lighthouse"
3. اختر:
   - [x] Performance
   - [x] Accessibility
   - [x] Best Practices
   - [x] SEO
4. اضغط "Analyze page load"
```

**النتائج المستهدفة:**
- [ ] Performance: > 80
- [ ] Accessibility: > 90
- [ ] Best Practices: > 80
- [ ] SEO: > 80

### 2. اختبار تحت الضغط

```
الخطوات:
1. افتح 10 تبويبات للتطبيق
2. في كل تبويب:
   - افتح صفحة مختلفة
   - قم بعملية (إنشاء طلب، رفع صورة، إلخ)
3. راقب:
   - [ ] استهلاك الذاكرة
   - [ ] سرعة الاستجابة
   - [ ] عدم حدوث أخطاء
```

**الوقت المتوقع:** 10 دقائق

---

## 🔒 اختبار الأمان الأساسي

### 1. اختبار الوصول غير المصرح

```
الخطوات:
1. سجل الخروج تماماً
2. حاول الوصول لـ:
   - /dashboard
   - /requests
   - /properties
```

**النتيجة المتوقعة:**
- [ ] إعادة توجيه تلقائي لصفحة Login
- [ ] رسالة "يجب تسجيل الدخول"

### 2. اختبار XSS Protection

```
الخطوات:
1. في نموذج طلب صيانة
2. أدخل في الوصف:
   <script>alert('XSS')</script>
3. احفظ الطلب
4. افتح تفاصيل الطلب
```

**النتيجة المتوقعة:**
- [ ] الـ script لا ينفذ
- [ ] النص يظهر كـ plain text
- [ ] DOMPurify يعمل بشكل صحيح

### 3. اختبار SQL Injection

```
الخطوات:
1. في البحث أو الفلاتر
2. أدخل: ' OR '1'='1
```

**النتيجة المتوقعة:**
- [ ] لا يحدث خطأ
- [ ] Supabase SDK يحمي تلقائياً
- [ ] نتائج البحث طبيعية أو فارغة

**الوقت المتوقع:** 10 دقائق

---

## 📊 سجل الاختبار

### قائمة التحقق النهائية

#### Frontend
- [ ] جميع الصفحات تفتح بدون أخطاء
- [ ] التنقل (Navigation) يعمل بشكل سليم
- [ ] النماذج تعمل وتحفظ البيانات
- [ ] رفع الملفات يعمل
- [ ] الخرائط تعمل (Google Maps)

#### Authentication
- [ ] التسجيل يعمل
- [ ] تسجيل الدخول يعمل
- [ ] تسجيل الخروج يعمل
- [ ] Session persistence تعمل
- [ ] Password reset يعمل (اختياري)

#### Database
- [ ] الطلبات تُحفظ بشكل صحيح
- [ ] العقارات تُحفظ
- [ ] الإشعارات تُحفظ
- [ ] RLS Policies تعمل (كل دور يرى ما يجب)

#### Edge Functions
- [ ] `chatbot` يعمل
- [ ] `error-tracking` يعمل
- [ ] `send-notification` يعمل
- [ ] `get-maps-key` يعمل (مع تحذير أمني)

#### Performance
- [ ] الصفحات تحمل بسرعة (< 3 ثواني)
- [ ] لا توجد تسريبات للذاكرة
- [ ] Lighthouse score مقبول

#### Security
- [ ] XSS Protection يعمل
- [ ] RLS يحمي البيانات
- [ ] الصلاحيات تعمل بشكل صحيح
- [ ] لا توجد أخطاء في Console

---

## 🐛 الأخطاء الشائعة وحلولها

### ❌ الخطأ: "Missing Supabase environment variables"

**الحل:**
```bash
# تأكد من وجود ملف .env
ls -la .env

# إذا لم يكن موجوداً، انسخ من .env.example
cp .env.example .env

# تحقق من المحتوى
cat .env
```

### ❌ الخطأ: "Failed to fetch" عند تسجيل الدخول

**الحل:**
```bash
# تأكد من تشغيل السيرفر
npm run dev

# تحقق من اتصال الإنترنت
ping supabase.co

# تحقق من Supabase Project Status
# https://status.supabase.com/
```

### ❌ الخطأ: "Google Maps failed to load"

**الحل:**
```bash
# تحقق من Supabase Secret: GOOGLE_MAPS_API_KEY
# في: https://supabase.com/dashboard/project/zrrffsjbfkphridqyais/settings/functions

# أو استخدم مفتاح تجريبي مؤقتاً
```

### ❌ الخطأ: "Row violates RLS policy"

**الحل:**
```bash
# تأكد من تسجيل الدخول
# تحقق من الدور (Role) في profiles table
# تأكد من أن RLS Policy صحيحة للدور
```

### ❌ الخطأ: Port 8080 already in use

**الحل:**
```bash
# أوقف العملية على المنفذ 8080
# Windows:
netstat -ano | findstr :8080
taskkill /PID <PID> /F

# Mac/Linux:
lsof -ti:8080 | xargs kill -9

# أو غير المنفذ في vite.config.ts
```

---

## 📝 تقرير الاختبار النهائي

### معلومات البيئة
```
- التاريخ: __________
- الوقت: __________
- النظام: Windows / Mac / Linux
- المتصفح: Chrome / Firefox / Safari
- الإصدار: __________
```

### النتائج
```
✅ الاختبارات الناجحة: ___ / 50
❌ الاختبارات الفاشلة: ___
⏭️  الاختبارات المتخطاة: ___
⏱️  الوقت الإجمالي: ___ دقيقة
```

### الأخطاء المكتشفة
```
1. ______________________________
2. ______________________________
3. ______________________________
```

### التوصيات
```
- ________________________________
- ________________________________
- ________________________________
```

---

## 📞 الدعم

### إذا واجهت مشاكل

1. **تحقق من Console Logs:**
   - اضغط F12 في المتصفح
   - تبويب Console
   - ابحث عن الأخطاء (بالأحمر)

2. **تحقق من Network Requests:**
   - F12 → Network tab
   - أعد تحميل الصفحة
   - ابحث عن الطلبات الفاشلة (حمراء)

3. **تحقق من Supabase Logs:**
   - Supabase Dashboard → Logs
   - اختر Edge Function Logs
   - ابحث عن الأخطاء

4. **أعد تشغيل السيرفر:**
   ```bash
   # أوقف السيرفر (Ctrl+C)
   # ثم شغله مرة أخرى
   npm run dev
   ```

### الموارد المفيدة
- [Supabase Documentation](https://supabase.com/docs)
- [React Documentation](https://react.dev)
- [Tailwind CSS](https://tailwindcss.com)

---

## ✨ الخلاصة

**الوقت الإجمالي المتوقع للاختبار الشامل:** 2-3 ساعات

**الأولوية:**
1. ✅ اختبار الوظائف الأساسية (Authentication, CRUD)
2. ✅ اختبار الصلاحيات (جميع الأدوار)
3. ✅ اختبار الأمان (XSS, RLS, Access Control)
4. ⏭️ اختبار الأداء (اختياري ولكن موصى به)

**بعد الانتهاء:**
- راجع `FINAL_REPORT.md` للقضايا المعروفة
- أصلح الأخطاء الحرجة (Google Maps API Key)
- استعد للنشر للإنتاج 🚀

---

**تم إعداد الدليل بواسطة:** Lovable AI  
**تاريخ:** 17 أكتوبر 2025  
**الحالة:** جاهز للاستخدام
